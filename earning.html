<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>GetInTheCar ‚Äî Earnings</title>
<link rel="stylesheet" href="style.css">
<style>
  /* ADD THESE STYLES AT THE TOP */
  :root {
    --accent-1: #ff5555;
    --accent-2: #ffdd00;
    --text: #ffffff;
    --muted: rgba(255, 255, 255, 0.6);
    --panel: #1a1a1a;
  }
  
  body.dark {
    background: #121212;
    color: var(--text);
  }
  
  .card {
    background: var(--panel);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  }
  
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 20px;
  }
  
  .btn {
    padding: 10px 20px;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .btn-primary {
    background: linear-gradient(135deg, var(--accent-1), var(--accent-2));
    color: #000;
  }
  
  .btn-secondary {
    background: rgba(255, 255, 255, 0.1);
    color: var(--text);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }
</style>
</head>
<body class="dark">

<!-- SIDEBAR -->
<aside class="sidebar card fade-in">
  <div class="brand">
    <div class="logo">NH</div>
    <div>
      <h2>GetInTheCar</h2>
      <div class="small muted">Driver Dashboard</div>
    </div>
  </div>

  <nav>
    <a href="driver.html">üöó Dashboard</a>
    <a href="earning.html" class="active">üí∞ Earnings</a>
    <a href="schedule.html">üìÖ Schedule</a>
    <a href="driverprofile.html">üë§ Profile</a>
    <a href="login.html">üîê Log Out</a>
  </nav>

  <div class="toggle-row">
    <div class="small muted">Dark Mode</div>
    <div id="darkSwitch" class="switch dark-toggle-on" title="Toggle dark mode">
      <div class="knob"></div>
    </div>
  </div>
</aside>

<!-- MAIN -->
<main class="main">
  <!-- Top Bar -->
  <div class="topbar">
    <div>
      <div class="header">Earnings Overview</div>
      <div class="small muted">Track your daily earnings and performance</div>
    </div>
    <div style="display:flex;align-items:center;gap:12px;">
      <button class="btn btn-secondary" onclick="refreshEarnings()">Refresh</button>
      <button class="btn btn-primary" onclick="withdrawEarnings()">Withdraw</button>
    </div>
  </div>

  <!-- Earnings Summary -->
  <div class="earnings-summary-container">
    <!-- Total Balance Card -->
    <div class="card total-balance-card fade-in">
      <div class="balance-header">
        <h3>üí∞ Available Balance</h3>
        <div class="balance-period">Ready to withdraw</div>
      </div>
      <div class="balance-amount">RM 142.50</div>
      <div class="balance-actions">
        <button class="btn btn-primary" onclick="withdrawEarnings()">Withdraw Now</button>
        <button class="btn btn-secondary" onclick="viewTransactionHistory()">View History</button>
      </div>
      <div class="balance-details">
        <div class="detail-item">
          <span>Pending (24h):</span>
          <span class="value pending">RM 45.80</span>
        </div>
        <div class="detail-item">
          <span>Last Withdrawal:</span>
          <span class="value">RM 50.00 (3 Dec)</span>
        </div>
        <div class="detail-item">
          <span>Next Payment:</span>
          <span class="value">Today, 2:00 PM</span>
        </div>
      </div>
    </div>

    <!-- Earnings Breakdown -->
    <div class="earnings-breakdown">
      <!-- Today's Earnings Card -->
      <div class="card earnings-card fade-in" style="animation-delay: 0.1s">
        <div class="earnings-card-header">
          <div class="earnings-icon">üìÖ</div>
          <div>
            <div class="earnings-title">Today</div>
            <div class="earnings-date">6 December 2024</div>
          </div>
        </div>
        <div class="earnings-amount">RM 68.50</div>
        <div class="earnings-details">
          <div class="earnings-metric">
            <span class="metric-label">Rides:</span>
            <span class="metric-value">5</span>
          </div>
          <div class="earnings-metric">
            <span class="metric-label">Avg/Ride:</span>
            <span class="metric-value">RM 13.70</span>
          </div>
          <div class="earnings-metric">
            <span class="metric-label">Hours:</span>
            <span class="metric-value">3.5h</span>
          </div>
          <div class="earnings-metric">
            <span class="metric-label">Hourly:</span>
            <span class="metric-value">RM 19.57</span>
          </div>
        </div>
        <div class="progress-container">
          <div class="progress-label">
            <span>Daily Goal (RM 80)</span>
            <span>86%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 86%"></div>
          </div>
        </div>
      </div>

      <!-- This Week Card -->
      <div class="card earnings-card fade-in" style="animation-delay: 0.2s">
        <div class="earnings-card-header">
          <div class="earnings-icon">üìä</div>
          <div>
            <div class="earnings-title">This Week</div>
            <div class="earnings-date">2-6 Dec 2024</div>
          </div>
        </div>
        <div class="earnings-amount">RM 342.50</div>
        <div class="earnings-details">
          <div class="earnings-metric">
            <span class="metric-label">Rides:</span>
            <span class="metric-value">22</span>
          </div>
          <div class="earnings-metric">
            <span class="metric-label">Avg/Ride:</span>
            <span class="metric-value">RM 15.57</span>
          </div>
          <div class="earnings-metric">
            <span class="metric-label">Hours:</span>
            <span class="metric-value">15.5h</span>
          </div>
          <div class="earnings-metric">
            <span class="metric-label">Hourly:</span>
            <span class="metric-value">RM 22.10</span>
          </div>
        </div>
        <div class="progress-container">
          <div class="progress-label">
            <span>Weekly Goal (RM 400)</span>
            <span>86%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 86%"></div>
          </div>
        </div>
      </div>

      <!-- This Month Card -->
      <div class="card earnings-card fade-in" style="animation-delay: 0.3s">
        <div class="earnings-card-header">
          <div class="earnings-icon">üí∞</div>
          <div>
            <div class="earnings-title">This Month</div>
            <div class="earnings-date">December 2024</div>
          </div>
        </div>
        <div class="earnings-amount">RM 685.00</div>
        <div class="earnings-details">
          <div class="earnings-metric">
            <span class="metric-label">Rides:</span>
            <span class="metric-value">48</span>
          </div>
          <div class="earnings-metric">
            <span class="metric-label">Avg/Ride:</span>
            <span class="metric-value">RM 14.27</span>
          </div>
          <div class="earnings-metric">
            <span class="metric-label">Hours:</span>
            <span class="metric-value">32h</span>
          </div>
          <div class="earnings-metric">
            <span class="metric-label">Hourly:</span>
            <span class="metric-value">RM 21.41</span>
          </div>
        </div>
        <div class="progress-container">
          <div class="progress-label">
            <span>Monthly Goal (RM 1,000)</span>
            <span>69%</span>
          </div>
          <div class="progress-bar">
            <div class="progress-fill" style="width: 69%"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Earnings Charts & Details -->
  <div class="earnings-details-container">
    <!-- Weekly Chart -->
    <div class="card earnings-chart-card fade-in">
      <div class="section-header">
        <h3>üìà Weekly Earnings Trend</h3>
        <select class="small-btn" onchange="changeChartPeriod(this.value)">
          <option value="week">This Week</option>
          <option value="month">This Month</option>
          <option value="year">This Year</option>
        </select>
      </div>
      <div class="chart-container">
        <div class="chart-bars" id="weeklyChart"></div>
        <div class="chart-legend">
          <div class="legend-item">
            <span class="legend-color" style="background: linear-gradient(135deg, var(--accent-1), var(--accent-2));"></span>
            <span class="legend-text">Daily Earnings</span>
          </div>
          <div class="legend-item">
            <span class="legend-color" style="background: rgba(255, 85, 85, 0.3);"></span>
            <span class="legend-text" id="averageText">Average: RM 67.03/day</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Recent Transactions -->
    <div class="card transactions-card fade-in" style="animation-delay: 0.2s">
      <div class="section-header">
        <h3>üí≥ Recent Transactions</h3>
        <button class="small-btn" onclick="viewAllTransactions()">View All</button>
      </div>
      <div class="transactions-list" id="recentTransactions">
        <!-- Transactions will be populated by JavaScript -->
      </div>
    </div>
  </div>

  <!-- Performance Metrics -->
  <div class="card performance-metrics-card fade-in" style="animation-delay: 0.3s">
    <div class="section-header">
      <h3>üìä Performance Metrics</h3>
      <div class="small muted">Compared to last month</div>
    </div>
    <div class="metrics-grid">
      <div class="metric-card">
        <div class="metric-header">
          <div class="metric-icon">üí∞</div>
          <div class="metric-title">Daily Average</div>
        </div>
        <div class="metric-value">RM 68.50</div>
        <div class="metric-change positive">
          <span class="change-icon">‚Üó</span>
          <span class="change-value">+8.2%</span>
        </div>
        <div class="metric-sub">From RM 63.30</div>
      </div>
      <div class="metric-card">
        <div class="metric-header">
          <div class="metric-icon">üöó</div>
          <div class="metric-title">Rides/Day</div>
        </div>
        <div class="metric-value">4.8</div>
        <div class="metric-change positive">
          <span class="change-icon">‚Üó</span>
          <span class="change-value">+6.7%</span>
        </div>
        <div class="metric-sub">From 4.5 rides</div>
      </div>
      <div class="metric-card">
        <div class="metric-header">
          <div class="metric-icon">‚≠ê</div>
          <div class="metric-title">Rating</div>
        </div>
        <div class="metric-value">4.7</div>
        <div class="metric-change positive">
          <span class="change-icon">‚Üó</span>
          <span class="change-value">+0.2</span>
        </div>
        <div class="metric-sub">From 4.5</div>
      </div>
      <div class="metric-card">
        <div class="metric-header">
          <div class="metric-icon">‚è∞</div>
          <div class="metric-title">Earnings/Hour</div>
        </div>
        <div class="metric-value">RM 19.57</div>
        <div class="metric-change positive">
          <span class="change-icon">‚Üó</span>
          <span class="change-value">+5.5%</span>
        </div>
        <div class="metric-sub">From RM 18.55</div>
      </div>
    </div>
  </div>

  <!-- Payment Methods -->
  <div class="card payment-methods-card fade-in" style="animation-delay: 0.4s">
    <div class="section-header">
      <h3>üè¶ Payment Methods</h3>
      <button class="small-btn" onclick="addPaymentMethod()">Add New</button>
    </div>
    <div class="payment-methods-list">
      <div class="payment-method active">
        <div class="payment-icon">üè¶</div>
        <div class="payment-details">
          <div class="payment-title">Maybank</div>
          <div class="payment-info">**** 1234 ‚Ä¢ Primary</div>
        </div>
        <div class="payment-action">
          <button class="small-btn" onclick="editPaymentMethod(1)">Edit</button>
        </div>
      </div>
      <div class="payment-method">
        <div class="payment-icon">üí≥</div>
        <div class="payment-details">
          <div class="payment-title">Touch 'n Go</div>
          <div class="payment-info">alif.mukhlis@email.com</div>
        </div>
        <div class="payment-action">
          <button class="small-btn" onclick="editPaymentMethod(2)">Edit</button>
        </div>
      </div>
      <div class="payment-method">
        <div class="payment-icon">üè¶</div>
        <div class="payment-details">
          <div class="payment-title">CIMB Bank</div>
          <div class="payment-info">**** 5678</div>
        </div>
        <div class="payment-action">
          <button class="small-btn" onclick="editPaymentMethod(3)">Edit</button>
        </div>
      </div>
    </div>
    <div class="payment-info-note">
      <div class="small muted">Payments processed daily at 2:00 PM. Minimum withdrawal: RM 20.00</div>
    </div>
  </div>
</main>

<!-- Withdrawal Modal -->
<div id="withdrawalModal" class="modal-overlay" style="display: none;">
  <div class="modal card">
    <div class="modal-header">
      <div class="modal-title">Withdraw Earnings</div>
      <button class="modal-close" onclick="closeWithdrawalModal()">√ó</button>
    </div>
    <div class="modal-content">
      <div class="withdrawal-info">
        <div class="available-balance">
          <span>Available Balance:</span>
          <span class="balance-amount">RM 142.50</span>
        </div>
        
        <div class="withdrawal-form">
          <label>Amount (RM)</label>
          <div class="amount-input-group">
            <span class="currency">RM</span>
            <input type="number" class="amount-input" id="withdrawalAmount" value="50.00" min="20" max="142.50" step="0.10">
          </div>
          <div class="amount-presets">
            <button class="amount-preset" onclick="setWithdrawalAmount(20)">RM 20</button>
            <button class="amount-preset" onclick="setWithdrawalAmount(50)">RM 50</button>
            <button class="amount-preset" onclick="setWithdrawalAmount(100)">RM 100</button>
            <button class="amount-preset" onclick="setWithdrawalAmount(142.50)">All</button>
          </div>
          
          <label>Payment Method</label>
          <select class="input" id="paymentMethod">
            <option value="1" selected>Maybank (**** 1234)</option>
            <option value="2">Touch 'n Go eWallet</option>
            <option value="3">CIMB Bank (**** 5678)</option>
          </select>
          
          <div class="withdrawal-summary">
            <div class="summary-item">
              <span>Withdrawal Amount:</span>
              <span id="summaryAmount">RM 50.00</span>
            </div>
            <div class="summary-item">
              <span>Processing Fee:</span>
              <span id="summaryFee">RM 0.50</span>
            </div>
            <div class="summary-item total">
              <span>Total Received:</span>
              <span id="summaryTotal">RM 49.50</span>
            </div>
          </div>
          
          <div class="processing-info">
            <div class="info-icon">‚è∞</div>
            <div class="info-text">Funds will arrive within 24 hours</div>
          </div>
        </div>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeWithdrawalModal()">Cancel</button>
      <button class="btn btn-primary" onclick="confirmWithdrawal()">Confirm Withdrawal</button>
    </div>
  </div>
</div>

<!-- Transaction History Modal -->
<div id="historyModal" class="modal-overlay" style="display: none;">
  <div class="modal card" style="max-width: 800px;">
    <div class="modal-header">
      <div class="modal-title">Transaction History</div>
      <button class="modal-close" onclick="closeHistoryModal()">√ó</button>
    </div>
    
    <div class="modal-content">
      <!-- Filters -->
      <div class="history-filters">
        <div class="filter-group">
          <label>Period</label>
          <select class="filter-select" id="historyPeriod" onchange="filterHistory()">
            <option value="all">All Time</option>
            <option value="today">Today</option>
            <option value="week">This Week</option>
            <option value="month" selected>This Month</option>
            <option value="last-month">Last Month</option>
            <option value="custom">Custom Range</option>
          </select>
        </div>
        
        <div class="filter-group">
          <label>Type</label>
          <select class="filter-select" id="historyType" onchange="filterHistory()">
            <option value="all">All Transactions</option>
            <option value="rides">Rides Only</option>
            <option value="withdrawals">Withdrawals Only</option>
            <option value="bonuses">Bonuses Only</option>
            <option value="cancellations">Cancellations Only</option>
          </select>
        </div>
        
        <div class="custom-date-range" id="customDateRange" style="display: none;">
          <div class="date-inputs">
            <input type="date" id="startDate" class="date-input" value="2024-11-01">
            <span class="date-separator">to</span>
            <input type="date" id="endDate" class="date-input" value="2024-12-06">
          </div>
          <button class="btn btn-secondary small-btn" onclick="applyCustomDateRange()">Apply</button>
        </div>
      </div>
      
      <!-- Summary -->
      <div class="history-summary">
        <div class="summary-card">
          <div class="summary-icon">üí∞</div>
          <div class="summary-content">
            <div class="summary-value" id="totalEarnings">RM 685.00</div>
            <div class="summary-label">Total Earnings</div>
          </div>
        </div>
        <div class="summary-card">
          <div class="summary-icon">üí∏</div>
          <div class="summary-content">
            <div class="summary-value" id="totalWithdrawals">RM 50.00</div>
            <div class="summary-label">Total Withdrawn</div>
          </div>
        </div>
        <div class="summary-card">
          <div class="summary-icon">üìä</div>
          <div class="summary-content">
            <div class="summary-value" id="totalTransactions">48</div>
            <div class="summary-label">Transactions</div>
          </div>
        </div>
      </div>
      
      <!-- Transactions Table -->
      <div class="history-table-container">
        <div class="table-header">
          <div class="table-cell date">Date & Time</div>
          <div class="table-cell description">Description</div>
          <div class="table-cell amount">Amount</div>
          <div class="table-cell status">Status</div>
        </div>
        
        <div class="table-body" id="historyTableBody">
          <!-- Transactions will be populated here -->
        </div>
        
        <div class="table-footer">
          <div class="pagination">
            <button class="pagination-btn" onclick="previousPage()">‚Üê Previous</button>
            <span class="pagination-info" id="pageInfo">Page 1 of 3</span>
            <button class="pagination-btn" onclick="nextPage()">Next ‚Üí</button>
          </div>
        </div>
      </div>
      
      <!-- Export Options -->
      <div class="export-options">
        <div class="export-title">Export History</div>
        <div class="export-buttons">
          <button class="btn btn-secondary" onclick="exportHistory('pdf')">
            <span>üìÑ</span> PDF
          </button>
          <button class="btn btn-secondary" onclick="exportHistory('csv')">
            <span>üìä</span> CSV
          </button>
          <button class="btn btn-secondary" onclick="exportHistory('print')">
            <span>üñ®Ô∏è</span> Print
          </button>
        </div>
      </div>
    </div>
    
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="closeHistoryModal()">Close</button>
      <button class="btn btn-primary" onclick="downloadStatement()">Download Full Statement</button>
    </div>
  </div>
</div>

<script>
  // Theme toggle logic
  const body = document.body;
  const darkSwitch = document.getElementById('darkSwitch');
  if (darkSwitch) {
    darkSwitch.addEventListener('click', () => {
      const knob = darkSwitch.querySelector('.knob');
      darkSwitch.classList.toggle('dark-toggle-on');
      body.classList.toggle('dark');
      if (body.classList.contains('dark')) {
        knob.style.left = '25px';
        knob.style.boxShadow = '0 10px 30px rgba(255, 221, 0, 0.12)';
      } else {
        knob.style.left = '3px';
        knob.style.boxShadow = '0 6px 18px rgba(255, 59, 48, 0.12)';
      }
    });
  }

  // Earnings data
  const earningsData = {
    totalBalance: 142.50,
    today: { amount: 68.50, rides: 5, hours: 3.5, goal: 80, progress: 86 },
    week: { amount: 342.50, rides: 22, hours: 15.5, goal: 400, progress: 86 },
    month: { amount: 685.00, rides: 48, hours: 32, goal: 1000, progress: 69 }
  };

  // Chart Data
  const chartData = {
    week: [
      { day: 'Mon', amount: 60.00, height: 75 },
      { day: 'Tue', amount: 70.50, height: 88 },
      { day: 'Wed', amount: 75.20, height: 94 },
      { day: 'Thu', amount: 65.00, height: 81 },
      { day: 'Fri', amount: 68.50, height: 86 },
      { day: 'Sat', amount: 80.00, height: 100 },
      { day: 'Sun', amount: 50.00, height: 63 }
    ],
    month: [
      { day: 'Week 1', amount: 275.50, height: 69 },
      { day: 'Week 2', amount: 342.50, height: 86 },
      { day: 'Week 3', amount: 310.00, height: 78 },
      { day: 'Week 4', amount: 68.50, height: 86 }
    ],
    year: [
      { day: 'Jan', amount: 1250.00, height: 65 },
      { day: 'Feb', amount: 1350.00, height: 70 },
      { day: 'Mar', amount: 1420.00, height: 74 },
      { day: 'Apr', amount: 1380.00, height: 72 },
      { day: 'May', amount: 1550.00, height: 81 },
      { day: 'Jun', amount: 1480.00, height: 77 },
      { day: 'Jul', amount: 1620.00, height: 84 },
      { day: 'Aug', amount: 1680.00, height: 87 },
      { day: 'Sep', amount: 1750.00, height: 91 },
      { day: 'Oct', amount: 1820.00, height: 95 },
      { day: 'Nov', amount: 1780.00, height: 93 },
      { day: 'Dec', amount: 685.00, height: 69 }
    ]
  };

  // Transaction history data - FIXED VERSION
  const transactionHistory = [
    // December 2024 - This Month
    { id: 2478, type: 'ride', description: 'Ride #2478', amount: 8.50, date: '2024-12-06 08:30', status: 'completed', passenger: 'Alif Mukhlis', distance: '2.1km' },
    { id: 2477, type: 'ride', description: 'Ride #2477', amount: 12.30, date: '2024-12-06 10:15', status: 'completed', passenger: 'Siti Aisyah', distance: '7.5km' },
    { id: 2476, type: 'ride', description: 'Ride #2476', amount: 6.80, date: '2024-12-06 11:45', status: 'completed', passenger: 'Hazim Firdaus', distance: '5.8km' },
    { id: 2475, type: 'ride', description: 'Ride #2475', amount: 8.50, date: '2024-12-06 14:30', status: 'completed', passenger: 'Ahmad R.', distance: '3.2km' },
    { id: 2474, type: 'ride', description: 'Ride #2474', amount: 9.20, date: '2024-12-06 16:45', status: 'completed', passenger: 'Nur Izzati', distance: '4.3km' },
    
    // December 5, 2024
    { id: 2473, type: 'ride', description: 'Ride #2473', amount: 7.50, date: '2024-12-05 09:15', status: 'completed', passenger: 'Mei Ling', distance: '3.0km' },
    { id: 2472, type: 'ride', description: 'Ride #2472', amount: 10.80, date: '2024-12-05 11:30', status: 'completed', passenger: 'Kumar Raj', distance: '6.2km' },
    { id: 2471, type: 'ride', description: 'Ride #2471', amount: 9.00, date: '2024-12-05 14:45', status: 'completed', passenger: 'Sarah Lim', distance: '4.5km' },
    { id: 2470, type: 'ride', description: 'Ride #2470', amount: 11.50, date: '2024-12-05 17:20', status: 'completed', passenger: 'Ali Hassan', distance: '7.0km' },
    
    // December 4, 2024
    { id: 2469, type: 'ride', description: 'Ride #2469', amount: 8.80, date: '2024-12-04 10:30', status: 'completed', passenger: 'Farid Jamil', distance: '3.8km' },
    { id: 2468, type: 'ride', description: 'Ride #2468', amount: 13.20, date: '2024-12-04 13:15', status: 'completed', passenger: 'Nina Sofia', distance: '8.0km' },
    { id: 2467, type: 'ride', description: 'Ride #2467', amount: 9.50, date: '2024-12-04 15:45', status: 'completed', passenger: 'Ramesh Kumar', distance: '5.0km' },
    
    // December 3, 2024 - Withdrawal
    { id: 'w001', type: 'withdrawal', description: 'Withdrawal to Maybank', amount: -50.00, date: '2024-12-03 14:00', status: 'completed', method: 'Maybank' },
    { id: 2466, type: 'ride', description: 'Ride #2466', amount: 7.80, date: '2024-12-03 11:20', status: 'completed', passenger: 'Zainal Abidin', distance: '3.5km' },
    
    // December 2, 2024
    { id: 2465, type: 'ride', description: 'Ride #2465', amount: 8.50, date: '2024-12-02 09:30', status: 'completed', passenger: 'Lisa Wong', distance: '4.2km' },
    { id: 2464, type: 'ride', description: 'Ride #2464', amount: 11.20, date: '2024-12-02 14:15', status: 'completed', passenger: 'Hafiz Rahman', distance: '6.8km' },
    { id: 2463, type: 'ride', description: 'Ride #2463', amount: 9.80, date: '2024-12-02 16:45', status: 'completed', passenger: 'Nadia Ali', distance: '5.1km' },
    
    // November 2024 - Last Month
    { id: 'b001', type: 'bonus', description: 'Weekend Bonus', amount: 10.00, date: '2024-11-30 18:00', status: 'completed', reason: 'Saturday rides bonus' },
    { id: 2462, type: 'ride', description: 'Ride #2462', amount: 12.50, date: '2024-11-30 10:30', status: 'completed', passenger: 'Jason Lee', distance: '7.5km' },
    { id: 2461, type: 'ride', description: 'Ride #2461', amount: 8.30, date: '2024-11-30 14:20', status: 'completed', passenger: 'Aina Sofea', distance: '4.8km' },
    { id: 'b002', type: 'bonus', description: 'Driver Referral Bonus', amount: 25.00, date: '2024-11-28 10:00', status: 'completed', reason: 'Referred new driver' },
    { id: 'w002', type: 'withdrawal', description: 'Withdrawal to Maybank', amount: -75.00, date: '2024-11-28 14:00', status: 'completed', method: 'Maybank' },
    { id: 2460, type: 'ride', description: 'Ride #2460', amount: 10.20, date: '2024-11-28 09:15', status: 'completed', passenger: 'Ravi Kumar', distance: '6.3km' },
    
    // October 2024
    { id: 2459, type: 'ride', description: 'Ride #2459', amount: 9.50, date: '2024-10-25 11:30', status: 'completed', passenger: 'Samantha Tan', distance: '5.2km' },
    { id: 2458, type: 'ride', description: 'Ride #2458', amount: 11.80, date: '2024-10-25 15:45', status: 'completed', passenger: 'Mohd Faiz', distance: '7.1km' },
    { id: 'w003', type: 'withdrawal', description: 'Withdrawal to Maybank', amount: -100.00, date: '2024-10-25 14:00', status: 'completed', method: 'Maybank' },
    
    // September 2024
    { id: 2457, type: 'ride', description: 'Ride #2457', amount: 8.90, date: '2024-09-20 13:20', status: 'completed', passenger: 'Chen Wei', distance: '4.9km' },
    { id: 'b003', type: 'bonus', description: 'Festival Bonus', amount: 15.00, date: '2024-09-16 09:00', status: 'completed', reason: 'Hari Raya bonus' },
    { id: 2456, type: 'ride', description: 'Ride #2456', amount: 12.50, date: '2024-09-16 18:30', status: 'completed', passenger: 'Ahmad Yusof', distance: '7.5km' },
    
    // More rides for November
    { id: 2455, type: 'ride', description: 'Ride #2455', amount: 7.50, date: '2024-11-25 08:45', status: 'completed', passenger: 'Muthu Samy', distance: '3.8km' },
    { id: 2454, type: 'ride', description: 'Ride #2454', amount: 10.50, date: '2024-11-25 12:30', status: 'completed', passenger: 'Nor Hayati', distance: '6.5km' },
    { id: 2453, type: 'ride', description: 'Ride #2453', amount: 9.20, date: '2024-11-25 16:15', status: 'completed', passenger: 'David Chen', distance: '5.1km' },
    
    // Cancelled rides
    { id: 'c001', type: 'cancellation', description: 'Cancellation Fee', amount: 3.00, date: '2024-11-20 09:30', status: 'completed', passenger: 'Ahmad Fauzi', reason: 'Late cancellation' },
    
    // October rides
    { id: 2451, type: 'ride', description: 'Ride #2451', amount: 8.00, date: '2024-10-15 10:00', status: 'completed', passenger: 'Lisa Wong', distance: '4.0km' },
    { id: 2450, type: 'ride', description: 'Ride #2450', amount: 10.50, date: '2024-10-15 14:30', status: 'completed', passenger: 'Hafiz Rahman', distance: '6.5km' },
    
    // Generate more rides for November to reach 48 total
    { id: 2449, type: 'ride', description: 'Ride #2449', amount: 7.80, date: '2024-11-18 11:20', status: 'completed', passenger: 'Siti Mariam', distance: '3.5km' },
    { id: 2448, type: 'ride', description: 'Ride #2448', amount: 9.50, date: '2024-11-18 15:45', status: 'completed', passenger: 'Raj Kumar', distance: '5.0km' },
    { id: 2447, type: 'ride', description: 'Ride #2447', amount: 11.20, date: '2024-11-17 10:30', status: 'completed', passenger: 'Nurul Iman', distance: '6.8km' },
    { id: 2446, type: 'ride', description: 'Ride #2446', amount: 8.30, date: '2024-11-17 14:15', status: 'completed', passenger: 'Ahmad Firdaus', distance: '4.8km' },
    { id: 2445, type: 'ride', description: 'Ride #2445', amount: 10.80, date: '2024-11-16 09:45', status: 'completed', passenger: 'Mei Lin', distance: '6.2km' },
    { id: 2444, type: 'ride', description: 'Ride #2444', amount: 7.50, date: '2024-11-16 13:30', status: 'completed', passenger: 'Kumar Suresh', distance: '3.8km' },
    { id: 2443, type: 'ride', description: 'Ride #2443', amount: 9.20, date: '2024-11-15 11:15', status: 'completed', passenger: 'Sarah Jones', distance: '5.1km' },
    { id: 2442, type: 'ride', description: 'Ride #2442', amount: 12.50, date: '2024-11-15 17:30', status: 'completed', passenger: 'Ali Baba', distance: '7.5km' },
    { id: 2441, type: 'ride', description: 'Ride #2441', amount: 8.50, date: '2024-11-14 10:45', status: 'completed', passenger: 'Farah Diyana', distance: '4.2km' },
    { id: 2440, type: 'ride', description: 'Ride #2440', amount: 11.00, date: '2024-11-14 16:20', status: 'completed', passenger: 'Ramesh Chandran', distance: '6.7km' },
    { id: 2439, type: 'ride', description: 'Ride #2439', amount: 7.80, date: '2024-11-13 09:30', status: 'completed', passenger: 'Nina Zainal', distance: '3.5km' },
    { id: 2438, type: 'ride', description: 'Ride #2438', amount: 10.50, date: '2024-11-13 14:45', status: 'completed', passenger: 'Hassan Ali', distance: '6.5km' },
    { id: 2437, type: 'ride', description: 'Ride #2437', amount: 8.90, date: '2024-11-12 11:20', status: 'completed', passenger: 'Chen Li', distance: '4.9km' },
    { id: 2436, type: 'ride', description: 'Ride #2436', amount: 9.50, date: '2024-11-12 15:30', status: 'completed', passenger: 'Ahmad Yusri', distance: '5.2km' },
    { id: 2435, type: 'ride', description: 'Ride #2435', amount: 11.80, date: '2024-11-11 10:15', status: 'completed', passenger: 'Siti Nora', distance: '7.1km' },
    { id: 2434, type: 'ride', description: 'Ride #2434', amount: 7.20, date: '2024-11-11 13:45', status: 'completed', passenger: 'Rajesh Kumar', distance: '3.2km' }
  ];

  // Initialize charts and recent transactions
  function initializeCharts() {
    renderChart('week');
    renderRecentTransactions();
  }

  function renderChart(period) {
    const chartContainer = document.getElementById('weeklyChart');
    if (!chartContainer) return;
    
    const data = chartData[period];
    const maxAmount = Math.max(...data.map(item => item.amount));
    
    chartContainer.innerHTML = '';
    
    let totalAmount = 0;
    
    data.forEach(item => {
      const bar = document.createElement('div');
      bar.className = 'chart-bar';
      
      const heightPercentage = (item.amount / maxAmount) * 100;
      const barHeight = Math.max(heightPercentage, 10);
      
      bar.innerHTML = `
        <div class="bar-label">${item.day}</div>
        <div class="bar-container">
          <div class="bar-fill" style="height: ${barHeight}%" 
               data-amount="RM ${item.amount.toFixed(2)}"></div>
        </div>
        <div class="bar-amount">RM ${item.amount.toFixed(2)}</div>
      `;
      
      chartContainer.appendChild(bar);
      totalAmount += item.amount;
    });
    
    const average = totalAmount / data.length;
    const averageText = document.getElementById('averageText');
    if (averageText) {
      averageText.textContent = `Average: RM ${average.toFixed(2)}/${period === 'week' ? 'day' : period === 'month' ? 'week' : 'month'}`;
    }
    
    addBarTooltips();
  }

  function addBarTooltips() {
    document.querySelectorAll('.bar-fill').forEach(bar => {
      bar.addEventListener('mouseenter', function(e) {
        const amount = this.getAttribute('data-amount');
        const tooltip = document.createElement('div');
        tooltip.className = 'chart-tooltip';
        tooltip.textContent = amount;
        tooltip.style.position = 'absolute';
        tooltip.style.bottom = 'calc(100% + 8px)';
        tooltip.style.left = '50%';
        tooltip.style.transform = 'translateX(-50%)';
        tooltip.style.padding = '6px 12px';
        tooltip.style.background = 'var(--panel)';
        tooltip.style.border = '1px solid rgba(255, 85, 85, 0.2)';
        tooltip.style.borderRadius = '8px';
        tooltip.style.boxShadow = '0 4px 12px rgba(0,0,0,0.1)';
        tooltip.style.fontSize = '12px';
        tooltip.style.fontWeight = '600';
        tooltip.style.whiteSpace = 'nowrap';
        tooltip.style.zIndex = '1000';
        
        this.appendChild(tooltip);
      });
      
      bar.addEventListener('mouseleave', function() {
        const tooltip = this.querySelector('.chart-tooltip');
        if (tooltip) tooltip.remove();
      });
    });
  }

  function renderRecentTransactions() {
    const container = document.getElementById('recentTransactions');
    if (!container) return;
    
    const recent = [...transactionHistory]
      .sort((a, b) => new Date(b.date) - new Date(a.date))
      .slice(0, 7);
    
    container.innerHTML = '';
    
    recent.forEach(transaction => {
      const item = document.createElement('div');
      item.className = 'transaction-item';
      
      let icon = 'üöó';
      if (transaction.type === 'withdrawal') icon = 'üí∏';
      if (transaction.type === 'bonus') icon = 'üéÅ';
      if (transaction.type === 'cancellation') icon = '‚ùå';
      
      const date = new Date(transaction.date);
      const timeStr = date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
      const dateStr = date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short' });
      
      item.innerHTML = `
        <div class="transaction-icon">${icon}</div>
        <div class="transaction-details">
          <div class="transaction-title">${transaction.description}</div>
          <div class="transaction-info">${transaction.passenger || transaction.method || transaction.reason || ''} ‚Ä¢ ${timeStr}</div>
        </div>
        <div class="transaction-amount ${transaction.amount >= 0 ? 'positive' : 'negative'}">
          ${transaction.amount >= 0 ? '+' : ''}RM ${Math.abs(transaction.amount).toFixed(2)}
        </div>
      `;
      
      container.appendChild(item);
    });
  }

  function changeChartPeriod(period) {
    let title = 'Weekly Earnings Trend';
    if (period === 'month') title = 'Monthly Earnings Trend';
    if (period === 'year') title = 'Yearly Earnings Trend';
    
    const titleElement = document.querySelector('.earnings-chart-card h3');
    if (titleElement) {
      titleElement.textContent = `üìà ${title}`;
    }
    renderChart(period);
  }

  // Withdrawal functionality
  function withdrawEarnings() {
    const withdrawalAmount = document.getElementById('withdrawalAmount');
    if (withdrawalAmount) {
      withdrawalAmount.value = '50.00';
    }
    updateWithdrawalSummary();
    document.getElementById('withdrawalModal').style.display = 'flex';
  }

  function closeWithdrawalModal() {
    document.getElementById('withdrawalModal').style.display = 'none';
  }

  function setWithdrawalAmount(amount) {
    const input = document.getElementById('withdrawalAmount');
    if (input) {
      input.value = amount === 142.50 ? earningsData.totalBalance.toFixed(2) : amount.toFixed(2);
      updateWithdrawalSummary();
    }
  }

  function updateWithdrawalSummary() {
    const input = document.getElementById('withdrawalAmount');
    if (!input) return;
    
    const amount = parseFloat(input.value) || 50.00;
    const fee = amount * 0.01;
    const totalFee = fee < 0.50 ? 0.50 : fee.toFixed(2);
    const total = (amount - totalFee).toFixed(2);
    
    const summaryAmount = document.getElementById('summaryAmount');
    const summaryFee = document.getElementById('summaryFee');
    const summaryTotal = document.getElementById('summaryTotal');
    
    if (summaryAmount) summaryAmount.textContent = `RM ${amount.toFixed(2)}`;
    if (summaryFee) summaryFee.textContent = `RM ${totalFee}`;
    if (summaryTotal) summaryTotal.textContent = `RM ${total}`;
  }

  function confirmWithdrawal() {
    const input = document.getElementById('withdrawalAmount');
    if (!input) return;
    
    const amount = parseFloat(input.value) || 50.00;
    const paymentMethod = document.getElementById('paymentMethod');
    const methodValue = paymentMethod ? paymentMethod.value : '1';
    
    if (amount < 20) {
      alert('Minimum withdrawal amount is RM 20.00');
      return;
    }
    
    if (amount > earningsData.totalBalance) {
      alert('Insufficient balance');
      return;
    }
    
    if (confirm(`Withdraw RM ${amount.toFixed(2)} to selected payment method?`)) {
      earningsData.totalBalance -= amount;
      
      const balanceElement = document.querySelector('.balance-amount');
      if (balanceElement) {
        balanceElement.textContent = `RM ${earningsData.totalBalance.toFixed(2)}`;
      }
      
      const newTransaction = {
        id: 'w' + Date.now(),
        type: 'withdrawal',
        description: 'Bank Transfer to ' + (methodValue === '1' ? 'Maybank' : methodValue === '2' ? 'Touch \'n Go' : 'CIMB Bank'),
        amount: -amount,
        date: new Date().toISOString().replace('T', ' ').substring(0, 16),
        status: 'pending',
        method: methodValue === '1' ? 'Maybank' : methodValue === '2' ? 'Touch \'n Go' : 'CIMB Bank'
      };
      
      transactionHistory.unshift(newTransaction);
      renderRecentTransactions();
      
      closeWithdrawalModal();
      showNotification(`Withdrawal request submitted for RM ${amount.toFixed(2)}. Funds will arrive within 24 hours.`);
    }
  }

  function refreshEarnings() {
    showNotification('Earnings data refreshed!');
  }

  function viewTransactionHistory() {
    document.getElementById('historyModal').style.display = 'flex';
    loadTransactionHistory();
  }

  function viewAllTransactions() {
    viewTransactionHistory();
  }

  function addPaymentMethod() {
    alert('Add new payment method feature coming soon!');
  }

  function editPaymentMethod(id) {
    alert(`Editing payment method #${id}`);
  }

  // Transaction History Modal Functions - FIXED VERSION
  function closeHistoryModal() {
    document.getElementById('historyModal').style.display = 'none';
  }
  
  let currentPage = 1;
  const itemsPerPage = 10;
  let filteredTransactions = [];
  
  function loadTransactionHistory() {
    // Make sure we have data
    filteredTransactions = [...transactionHistory];
    
    // Sort by date (newest first)
    filteredTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
    
    // Update summary
    updateSummary();
    
    // Reset to first page and render
    currentPage = 1;
    renderTable();
    
    console.log('Loaded transactions:', filteredTransactions.length);
  }
  
  function filterHistory() {
    const periodSelect = document.getElementById('historyPeriod');
    const typeSelect = document.getElementById('historyType');
    
    if (!periodSelect || !typeSelect) {
      console.error('Filter elements not found');
      return;
    }
    
    const period = periodSelect.value;
    const type = typeSelect.value;
    const now = new Date();
    
    filteredTransactions = transactionHistory.filter(transaction => {
      // Filter by type
      if (type !== 'all' && transaction.type !== type) {
        return false;
      }
      
      // Filter by period
      const transactionDate = new Date(transaction.date);
      
      switch(period) {
        case 'today':
          return transactionDate.toDateString() === now.toDateString();
        case 'week':
          const startOfWeek = new Date(now);
          startOfWeek.setDate(now.getDate() - now.getDay());
          startOfWeek.setHours(0, 0, 0, 0);
          return transactionDate >= startOfWeek;
        case 'month':
          return transactionDate.getMonth() === now.getMonth() && 
                 transactionDate.getFullYear() === now.getFullYear();
        case 'last-month':
          const lastMonth = new Date(now);
          lastMonth.setMonth(lastMonth.getMonth() - 1);
          return transactionDate.getMonth() === lastMonth.getMonth() && 
                 transactionDate.getFullYear() === lastMonth.getFullYear();
        case 'custom':
          return true;
        default: // 'all'
          return true;
      }
    });
    
    filteredTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
    updateSummary();
    currentPage = 1;
    renderTable();
  }
  
  function applyCustomDateRange() {
    const startDateInput = document.getElementById('startDate');
    const endDateInput = document.getElementById('endDate');
    
    if (!startDateInput || !endDateInput) return;
    
    const startDate = new Date(startDateInput.value);
    const endDate = new Date(endDateInput.value);
    
    filteredTransactions = transactionHistory.filter(transaction => {
      const transactionDate = new Date(transaction.date);
      return transactionDate >= startDate && transactionDate <= endDate;
    });
    
    filteredTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
    updateSummary();
    currentPage = 1;
    renderTable();
  }
  
  function updateSummary() {
    const totalEarnings = filteredTransactions
      .filter(t => t.amount > 0 && (t.type === 'ride' || t.type === 'bonus' || t.type === 'cancellation'))
      .reduce((sum, t) => sum + t.amount, 0);
    
    const totalWithdrawals = filteredTransactions
      .filter(t => t.type === 'withdrawal')
      .reduce((sum, t) => sum + Math.abs(t.amount), 0);
    
    const totalEarningsElem = document.getElementById('totalEarnings');
    const totalWithdrawalsElem = document.getElementById('totalWithdrawals');
    const totalTransactionsElem = document.getElementById('totalTransactions');
    
    if (totalEarningsElem) totalEarningsElem.textContent = `RM ${totalEarnings.toFixed(2)}`;
    if (totalWithdrawalsElem) totalWithdrawalsElem.textContent = `RM ${totalWithdrawals.toFixed(2)}`;
    if (totalTransactionsElem) totalTransactionsElem.textContent = filteredTransactions.length;
  }
  
  function renderTable() {
    const tableBody = document.getElementById('historyTableBody');
    if (!tableBody) {
      console.error('Table body not found');
      return;
    }
    
    tableBody.innerHTML = '';
    
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const pageTransactions = filteredTransactions.slice(startIndex, endIndex);
    
    console.log('Rendering transactions:', pageTransactions.length);
    
    if (pageTransactions.length === 0) {
      tableBody.innerHTML = `
        <div class="empty-state" style="grid-column: 1 / -1; text-align: center; padding: 60px 20px;">
          <div class="empty-icon">üìä</div>
          <h4>No Transactions Found</h4>
          <p class="small muted">No transactions match your selected filters.</p>
        </div>
      `;
    } else {
      pageTransactions.forEach(transaction => {
        const row = document.createElement('div');
        row.className = 'table-row';
        
        // Format date
        const date = new Date(transaction.date);
        const dateStr = date.toLocaleDateString('en-GB', { day: 'numeric', month: 'short', year: 'numeric' });
        const timeStr = date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
        
        // Get icon based on type
        let icon = 'üöó';
        if (transaction.type === 'withdrawal') icon = 'üí∏';
        if (transaction.type === 'bonus') icon = 'üéÅ';
        if (transaction.type === 'cancellation') icon = '‚ùå';
        
        // Get status color
        let statusClass = 'status-completed';
        if (transaction.status === 'cancelled') statusClass = 'status-cancelled';
        if (transaction.status === 'pending') statusClass = 'status-pending';
        
        row.innerHTML = `
          <div class="table-cell date">
            <div class="date-main">${dateStr}</div>
            <div class="date-time">${timeStr}</div>
          </div>
          <div class="table-cell description">
            <div class="transaction-icon-small">${icon}</div>
            <div>
              <div class="transaction-desc">${transaction.description}</div>
              <div class="transaction-details">${getTransactionDetails(transaction)}</div>
            </div>
          </div>
          <div class="table-cell amount ${transaction.amount >= 0 ? 'positive' : 'negative'}">
            ${transaction.amount >= 0 ? '+' : ''}RM ${Math.abs(transaction.amount).toFixed(2)}
          </div>
          <div class="table-cell status">
            <span class="status-badge ${statusClass}">${transaction.status}</span>
          </div>
        `;
        
        tableBody.appendChild(row);
      });
    }
    
    // Update pagination info
    const totalPages = Math.ceil(filteredTransactions.length / itemsPerPage);
    const pageInfo = document.getElementById('pageInfo');
    if (pageInfo) {
      pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
    }
  }
  
  function getTransactionDetails(transaction) {
    switch(transaction.type) {
      case 'ride':
        return `${transaction.passenger || 'Passenger'} ‚Ä¢ ${transaction.distance || 'N/A'}`;
      case 'withdrawal':
        return `Bank Transfer ‚Ä¢ ${transaction.method || 'N/A'}`;
      case 'bonus':
        return transaction.reason || 'Bonus';
      case 'cancellation':
        return `${transaction.passenger || 'Passenger'} ‚Ä¢ ${transaction.reason || 'Cancellation'}`;
      default:
        return '';
    }
  }
  
  function previousPage() {
    if (currentPage > 1) {
      currentPage--;
      renderTable();
    }
  }
  
  function nextPage() {
    const totalPages = Math.ceil(filteredTransactions.length / itemsPerPage);
    if (currentPage < totalPages) {
      currentPage++;
      renderTable();
    }
  }
  
  function exportHistory(format) {
    switch(format) {
      case 'pdf':
        showNotification('Generating PDF report...');
        break;
      case 'csv':
        showNotification('Downloading CSV file...');
        break;
      case 'print':
        window.print();
        break;
    }
  }
  
  function downloadStatement() {
    showNotification('Preparing full statement for download...');
  }

  function showNotification(message) {
    const notification = document.createElement('div');
    notification.className = 'notification';
    notification.innerHTML = `
      <div class="notification-content">
        <span>${message}</span>
      </div>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
      notification.remove();
    }, 3000);
  }

  // Initialize when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    console.log('DOM loaded, initializing...');
    
    // Initialize charts
    initializeCharts();
    
    // Initialize withdrawal amount listener
    const withdrawalInput = document.getElementById('withdrawalAmount');
    if (withdrawalInput) {
      withdrawalInput.addEventListener('input', updateWithdrawalSummary);
    }
    
    // Initialize event listeners for custom date range
    const historyPeriod = document.getElementById('historyPeriod');
    if (historyPeriod) {
      historyPeriod.addEventListener('change', function() {
        const customRange = document.getElementById('customDateRange');
        if (customRange) {
          if (this.value === 'custom') {
            customRange.style.display = 'flex';
          } else {
            customRange.style.display = 'none';
            filterHistory();
          }
        }
      });
    }
    
    // Test: Simulate clicking View History to see if it works
    console.log('Transaction history ready:', transactionHistory.length, 'transactions');
  });

  // Close modal on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      closeWithdrawalModal();
      closeHistoryModal();
    }
  });

  // Close modal on overlay click
  const withdrawalModal = document.getElementById('withdrawalModal');
  if (withdrawalModal) {
    withdrawalModal.addEventListener('click', (e) => {
      if (e.target === withdrawalModal) {
        closeWithdrawalModal();
      }
    });
  }
  
  const historyModal = document.getElementById('historyModal');
  if (historyModal) {
    historyModal.addEventListener('click', (e) => {
      if (e.target === historyModal) {
        closeHistoryModal();
      }
    });
  }
</script>

<style>
  /* Earnings Page Specific Styles - COMPLETE VERSION */
  .earnings-summary-container {
    display: flex;
    flex-direction: column;
    gap: 20px;
    margin-bottom: 20px;
  }

  .total-balance-card {
    padding: 30px;
    background: linear-gradient(135deg, rgba(255, 85, 85, 0.1), rgba(255, 221, 0, 0.05));
    border: 2px solid rgba(255, 85, 85, 0.2);
  }

  .balance-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .balance-header h3 {
    margin: 0;
    font-size: 20px;
    font-weight: 700;
  }

  .balance-period {
    font-size: 14px;
    color: var(--muted);
  }

  .balance-amount {
    font-size: 48px;
    font-weight: 800;
    color: var(--accent-1);
    margin-bottom: 30px;
    text-align: center;
  }

  .balance-actions {
    display: flex;
    gap: 12px;
    margin-bottom: 30px;
  }

  .balance-actions .btn {
    flex: 1;
  }

  .balance-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 85, 85, 0.2);
  }

  .detail-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px;
    background: rgba(255, 85, 85, 0.05);
    border-radius: 8px;
    font-size: 14px;
  }

  .detail-item .value {
    font-weight: 700;
  }

  .detail-item .value.pending {
    color: #ffcc00;
  }

  .earnings-breakdown {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
  }

  .earnings-card {
    padding: 24px;
    transition: all 0.2s ease;
  }

  .earnings-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 12px 28px rgba(255, 59, 48, 0.15);
  }

  .earnings-card-header {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-bottom: 20px;
  }

  .earnings-icon {
    font-size: 24px;
    width: 50px;
    height: 50px;
    border-radius: 12px;
    background: linear-gradient(135deg, rgba(255, 85, 85, 0.1), rgba(255, 221, 0, 0.05));
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .earnings-title {
    font-weight: 700;
    font-size: 18px;
    margin-bottom: 4px;
  }

  .earnings-date {
    font-size: 12px;
    color: var(--muted);
  }

  .earnings-amount {
    font-size: 36px;
    font-weight: 800;
    color: var(--accent-1);
    margin-bottom: 20px;
    text-align: center;
  }

  .earnings-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 12px;
    margin-bottom: 20px;
  }

  .earnings-metric {
    padding: 12px;
    background: rgba(255, 85, 85, 0.02);
    border-radius: 8px;
    border: 1px solid rgba(255, 85, 85, 0.05);
    text-align: center;
  }

  .metric-label {
    font-size: 12px;
    color: var(--muted);
    display: block;
    margin-bottom: 4px;
  }

  .metric-value {
    font-weight: 700;
    font-size: 14px;
  }

  .progress-container {
    margin-top: 20px;
  }

  .progress-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 8px;
    font-size: 12px;
    color: var(--muted);
  }

  .progress-bar {
    height: 8px;
    background: rgba(255, 85, 85, 0.1);
    border-radius: 4px;
    overflow: hidden;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-1), var(--accent-2));
    border-radius: 4px;
    transition: width 0.3s ease;
  }

  /* Charts & Details */
  .earnings-details-container {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
    margin-bottom: 20px;
  }

  .earnings-chart-card,
  .transactions-card {
    padding: 24px;
  }

  .chart-container {
    margin-top: 20px;
  }

  .chart-bars {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    height: 200px;
    padding: 20px 0;
    border-bottom: 1px solid rgba(255, 85, 85, 0.1);
  }

  .chart-bar {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    position: relative;
    min-width: 50px;
  }

  .bar-label {
    font-size: 12px;
    color: var(--muted);
    font-weight: 600;
  }

  .bar-container {
    width: 80%;
    height: 150px;
    background: rgba(255, 85, 85, 0.05);
    border-radius: 6px;
    position: relative;
    overflow: visible;
    cursor: pointer;
  }

  .bar-fill {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(to top, var(--accent-1), var(--accent-2));
    border-radius: 6px 6px 0 0;
    transition: all 0.3s ease;
  }

  .bar-fill:hover {
    background: linear-gradient(to top, #ff5555, #ffdd00);
    transform: scale(1.05);
    box-shadow: 0 4px 20px rgba(255, 85, 85, 0.3);
  }

  .bar-amount {
    font-size: 12px;
    font-weight: 600;
    color: var(--accent-1);
    margin-top: 4px;
  }

  .chart-legend {
    display: flex;
    gap: 20px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid rgba(255, 85, 85, 0.1);
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    color: var(--muted);
  }

  .legend-color {
    width: 16px;
    height: 16px;
    border-radius: 4px;
  }

  /* Transactions */
  .transactions-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 20px;
  }

  .transaction-item {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 16px;
    background: rgba(255, 85, 85, 0.02);
    border-radius: 12px;
    border: 1px solid rgba(255, 85, 85, 0.05);
    transition: all 0.2s ease;
  }

  .transaction-item:hover {
    background: rgba(255, 85, 85, 0.05);
    transform: translateX(4px);
  }

  .transaction-icon {
    font-size: 20px;
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: linear-gradient(135deg, rgba(255, 85, 85, 0.1), rgba(255, 221, 0, 0.05));
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .transaction-details {
    flex: 1;
  }

  .transaction-title {
    font-weight: 700;
    font-size: 14px;
    margin-bottom: 4px;
  }

  .transaction-info {
    font-size: 12px;
    color: var(--muted);
  }

  .transaction-amount {
    font-weight: 800;
    font-size: 16px;
  }

  .transaction-amount.positive {
    color: #00ff00;
  }

  .transaction-amount.negative {
    color: #ff5555;
  }

  /* Performance Metrics */
  .performance-metrics-card {
    padding: 24px;
    margin-bottom: 20px;
  }

  .metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
  }

  .metric-card {
    padding: 20px;
    background: rgba(255, 85, 85, 0.02);
    border-radius: 12px;
    border: 1px solid rgba(255, 85, 85, 0.1);
    transition: all 0.2s ease;
  }

  .metric-card:hover {
    background: rgba(255, 85, 85, 0.05);
    transform: translateY(-2px);
  }

  .metric-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 16px;
  }

  .metric-icon {
    font-size: 20px;
    width: 40px;
    height: 40px;
    border-radius: 10px;
    background: linear-gradient(135deg, rgba(255, 85, 85, 0.1), rgba(255, 221, 0, 0.05));
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .metric-title {
    font-weight: 600;
    font-size: 14px;
  }

  .metric-value {
    font-size: 28px;
    font-weight: 800;
    color: var(--accent-1);
    margin-bottom: 8px;
  }

  .metric-change {
    display: flex;
    align-items: center;
    gap: 4px;
    font-size: 14px;
    font-weight: 600;
    margin-bottom: 4px;
  }

  .metric-change.positive {
    color: #00ff00;
  }

  .metric-change.negative {
    color: #ff5555;
  }

  .change-icon {
    font-size: 16px;
  }

  .metric-sub {
    font-size: 12px;
    color: var(--muted);
  }

  /* Payment Methods */
  .payment-methods-card {
    padding: 24px;
  }

  .payment-methods-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-top: 20px;
  }

  .payment-method {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 20px;
    background: rgba(255, 85, 85, 0.02);
    border-radius: 12px;
    border: 1px solid rgba(255, 85, 85, 0.1);
    transition: all 0.2s ease;
  }

  .payment-method.active {
    background: rgba(255, 85, 85, 0.05);
    border-color: var(--accent-1);
  }

  .payment-method:hover {
    background: rgba(255, 85, 85, 0.05);
  }

  .payment-icon {
    font-size: 20px;
    width: 50px;
    height: 50px;
    border-radius: 10px;
    background: linear-gradient(135deg, rgba(255, 85, 85, 0.1), rgba(255, 221, 0, 0.05));
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .payment-details {
    flex: 1;
  }

  .payment-title {
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 4px;
  }

  .payment-info {
    font-size: 12px;
    color: var(--muted);
  }

  .payment-action {
    margin-left: auto;
  }

  .payment-info-note {
    margin-top: 20px;
    padding: 16px;
    background: rgba(255, 85, 85, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(255, 85, 85, 0.1);
  }

  /* Withdrawal Modal */
  .withdrawal-info {
    padding: 20px;
  }

  .available-balance {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px;
    background: rgba(255, 85, 85, 0.05);
    border-radius: 12px;
    margin-bottom: 24px;
    font-weight: 600;
  }

  .balance-amount {
    font-size: 24px;
    font-weight: 800;
    color: var(--accent-1);
  }

  .withdrawal-form {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .amount-input-group {
    position: relative;
  }

  .currency {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    font-weight: 700;
    font-size: 20px;
    color: var(--accent-1);
  }

  .amount-input {
    width: 100%;
    padding: 16px 16px 16px 60px;
    font-size: 24px;
    font-weight: 800;
    background: rgba(255, 255, 255, 0.05);
    border: 2px solid var(--accent-1);
    border-radius: 12px;
    color: var(--text);
    text-align: center;
    outline: none;
  }

  .amount-input:focus {
    box-shadow: 0 0 0 3px rgba(255, 85, 85, 0.2);
  }

  .amount-presets {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
  }

  .amount-preset {
    padding: 12px;
    background: rgba(255, 85, 85, 0.05);
    border: 1px solid rgba(255, 85, 85, 0.1);
    border-radius: 8px;
    color: var(--text);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .amount-preset:hover {
    background: rgba(255, 85, 85, 0.1);
    border-color: var(--accent-1);
  }

  .withdrawal-summary {
    padding: 20px;
    background: rgba(255, 85, 85, 0.05);
    border-radius: 12px;
    border: 1px solid rgba(255, 85, 85, 0.1);
  }

  .summary-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid rgba(255, 85, 85, 0.1);
  }

  .summary-item.total {
    border-bottom: none;
    padding-top: 16px;
    margin-top: 8px;
    border-top: 2px solid rgba(255, 85, 85, 0.2);
    font-size: 18px;
    font-weight: 800;
  }

  .processing-info {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: rgba(255, 85, 85, 0.05);
    border-radius: 8px;
    border: 1px solid rgba(255, 85, 85, 0.1);
    font-size: 14px;
  }

  .info-icon {
    font-size: 20px;
  }

  .info-text {
    flex: 1;
  }

  /* History Modal Styles - COMPLETE VERSION */
  .history-filters {
    display: flex;
    gap: 16px;
    margin-bottom: 24px;
    flex-wrap: wrap;
    align-items: flex-end;
  }
  
  .filter-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
    flex: 1;
    min-width: 150px;
  }
  
  .filter-group label {
    font-size: 12px;
    font-weight: 600;
    color: var(--muted);
  }
  
  .filter-select {
    padding: 10px 12px;
    border-radius: 8px;
    background: rgba(255, 85, 85, 0.05);
    border: 1px solid rgba(255, 85, 85, 0.1);
    color: var(--text);
    font-size: 14px;
    outline: none;
    cursor: pointer;
  }
  
  .filter-select:focus {
    border-color: var(--accent-1);
  }
  
  .custom-date-range {
    display: flex;
    gap: 12px;
    align-items: flex-end;
    width: 100%;
    margin-top: 8px;
  }
  
  .date-inputs {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
  }
  
  .date-input {
    flex: 1;
    padding: 10px 12px;
    border-radius: 8px;
    background: rgba(255, 85, 85, 0.05);
    border: 1px solid rgba(255, 85, 85, 0.1);
    color: var(--text);
    font-size: 14px;
    outline: none;
  }
  
  .date-separator {
    color: var(--muted);
    font-weight: 600;
  }
  
  .history-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    margin-bottom: 24px;
  }
  
  .summary-card {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 20px;
    border-radius: 12px;
    background: rgba(255, 85, 85, 0.05);
    border: 1px solid rgba(255, 85, 85, 0.1);
  }
  
  .summary-icon {
    font-size: 24px;
    width: 50px;
    height: 50px;
    border-radius: 10px;
    background: linear-gradient(135deg, rgba(255, 85, 85, 0.1), rgba(255, 221, 0, 0.05));
    display: flex;
    align-items: center;
    justify-content: center;
  }
  
  .summary-content {
    flex: 1;
  }
  
  .summary-value {
    font-size: 24px;
    font-weight: 800;
    color: var(--accent-1);
    margin-bottom: 4px;
  }
  
  .summary-label {
    font-size: 12px;
    color: var(--muted);
  }
  
  .history-table-container {
    background: rgba(255, 85, 85, 0.02);
    border-radius: 12px;
    border: 1px solid rgba(255, 85, 85, 0.1);
    overflow: hidden;
    margin-bottom: 24px;
  }
  
  .table-header {
    display: grid;
    grid-template-columns: 150px 1fr 120px 100px;
    padding: 16px 20px;
    background: rgba(255, 85, 85, 0.05);
    border-bottom: 1px solid rgba(255, 85, 85, 0.1);
    font-weight: 700;
    font-size: 14px;
  }
  
  .table-cell {
    padding: 0 8px;
  }
  
  .table-body {
    max-height: 400px;
    overflow-y: auto;
  }
  
  .table-row {
    display: grid;
    grid-template-columns: 150px 1fr 120px 100px;
    padding: 16px 20px;
    border-bottom: 1px solid rgba(255, 85, 85, 0.05);
    transition: all 0.2s ease;
  }
  
  .table-row:hover {
    background: rgba(255, 85, 85, 0.03);
  }
  
  .table-row:last-child {
    border-bottom: none;
  }
  
  .date-main {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 4px;
  }
  
  .date-time {
    font-size: 12px;
    color: var(--muted);
  }
  
  .description {
    display: flex;
    align-items: center;
    gap: 12px;
  }
  
  .transaction-icon-small {
    font-size: 16px;
    width: 32px;
    height: 32px;
    border-radius: 8px;
    background: linear-gradient(135deg, rgba(255, 85, 85, 0.1), rgba(255, 221, 0, 0.05));
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  
  .transaction-desc {
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 4px;
  }
  
  .transaction-details {
    font-size: 12px;
    color: var(--muted);
  }
  
  .amount {
    font-weight: 800;
    font-size: 16px;
    display: flex;
    align-items: center;
  }
  
  .amount.positive {
    color: #00ff00;
  }
  
  .amount.negative {
    color: #ff5555;
  }
  
  .status-badge {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .status-completed {
    background: rgba(0, 255, 0, 0.1);
    color: #00ff00;
    border: 1px solid rgba(0, 255, 0, 0.2);
  }
  
  .status-cancelled {
    background: rgba(255, 85, 85, 0.1);
    color: #ff5555;
    border: 1px solid rgba(255, 85, 85, 0.2);
  }
  
  .status-pending {
    background: rgba(255, 221, 0, 0.1);
    color: #ffdd00;
    border: 1px solid rgba(255, 221, 0, 0.2);
  }
  
  .table-footer {
    padding: 16px 20px;
    border-top: 1px solid rgba(255, 85, 85, 0.1);
    display: flex;
    justify-content: center;
  }
  
  .pagination {
    display: flex;
    align-items: center;
    gap: 20px;
  }
  
  .pagination-btn {
    padding: 8px 16px;
    background: rgba(255, 85, 85, 0.05);
    border: 1px solid rgba(255, 85, 85, 0.1);
    border-radius: 8px;
    color: var(--text);
    font-size: 14px;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .pagination-btn:hover:not(:disabled) {
    background: rgba(255, 85, 85, 0.1);
    border-color: var(--accent-1);
  }
  
  .pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  
  .pagination-info {
    font-weight: 600;
    font-size: 14px;
    color: var(--accent-1);
  }
  
  .export-options {
    padding: 20px;
    background: rgba(255, 85, 85, 0.02);
    border-radius: 12px;
    border: 1px solid rgba(255, 85, 85, 0.1);
    margin-bottom: 24px;
  }
  
  .export-title {
    font-weight: 700;
    font-size: 16px;
    margin-bottom: 16px;
    color: var(--accent-1);
  }
  
  .export-buttons {
    display: flex;
    gap: 12px;
  }
  
  .export-buttons .btn {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
  }
  
  .empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 60px 20px;
  }
  
  .empty-icon {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
  }
  
  .empty-state h4 {
    margin: 0 0 8px 0;
    font-size: 18px;
  }

  /* Notification */
  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    animation: slideInRight 0.3s ease;
  }

  .notification-content {
    padding: 16px 24px;
    background: var(--panel);
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(255, 59, 48, 0.2);
    border: 1px solid rgba(255, 85, 85, 0.1);
    font-weight: 600;
  }

  @keyframes slideInRight {
    from {
      transform: translateX(100%);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .earnings-details-container {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .earnings-breakdown {
      grid-template-columns: 1fr;
    }
    
    .metrics-grid {
      grid-template-columns: 1fr 1fr;
    }
    
    .balance-actions {
      flex-direction: column;
    }
    
    .chart-bars {
      overflow-x: auto;
      padding-bottom: 20px;
    }
    
    .chart-bar {
      min-width: 60px;
    }
    
    .amount-presets {
      grid-template-columns: repeat(2, 1fr);
    }
    
    .table-header,
    .table-row {
      grid-template-columns: 120px 1fr 100px 80px;
    }
    
    .history-filters {
      flex-direction: column;
      align-items: stretch;
    }
    
    .filter-group {
      min-width: auto;
    }
    
    .custom-date-range {
      flex-direction: column;
      align-items: stretch;
    }
    
    .history-summary {
      grid-template-columns: 1fr;
    }
    
    .export-buttons {
      flex-direction: column;
    }
  }

  @media (max-width: 480px) {
    .metrics-grid {
      grid-template-columns: 1fr;
    }
    
    .balance-details {
      grid-template-columns: 1fr;
    }
    
    .earnings-details {
      grid-template-columns: 1fr;
    }
    
    .topbar {
      flex-direction: column;
      align-items: flex-start;
      gap: 12px;
    }
    
    .table-header,
    .table-row {
      grid-template-columns: 100px 1fr 80px 70px;
      padding: 12px;
    }
    
    .table-cell.date {
      padding-right: 4px;
    }
    
    .modal-actions {
      flex-direction: column;
    }
    
    .modal-actions .btn {
      width: 100%;
    }
  }
</style>
</body>
</html>